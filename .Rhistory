if (errcode[i,1]==35)
{cat(" \n")
cat("ERROR: In a model with only one moderator, that moderator must be W. \n")}
if (errcode[i,1]==36)
{cat(" \n")
cat("ERROR: A serial mediation model cannot have more than 6 mediators. \n")}
if (errcode[i,1]==37)
{cat(" \n")
cat("ERROR: No more than 10 mediators are allowed in a PROCESS command. \n")}
if (errcode[i,1]==38)
{cat(" \n")
cat("ERROR: XCATCODE is not provided, not the correct length, or is otherwise invalid. \n")}
if (errcode[i,1]==39)
{cat(" \n")
cat("ERROR: WCATCODE is not provided, not the correct length, or is otherwise invalid. \n")}
if (errcode[i,1]==40)
{cat(" \n")
cat("ERROR: ZCATCODE is not provided, not the correct length, or is otherwise invalid. \n")}
if (errcode[i,1]==41)
{cat(" \n")
cat("ERROR: Models 1, 2, and 3 cannot be customized. \n")}
if (errcode[i,1]==43)
{cat(" \n")
cat("ERROR: PROCESS does not allow dichotomous mediators. \n")}
if (errcode[i,1]==50)
{cat(" \n")
cat("ERROR: A multicategorical moderator cannot be specified as a covariate. \n")}
if (errcode[i,1]==51)
{cat(" \n")
cat("ERROR: A variable you specified as a covariate is a moderator in all equations. \n")}
if (errcode[i,1]==62)
{cat(" \n")
cat("ERROR: After listwise deletion of cases with missing data, too few cases remain. \n")}
if (errcode[i,1]==63)
{cat(" \n")
cat("ERROR: The XMINT option is available only for model 4. \n")}
if (errcode[i,1]==64)
{cat(" \n")
cat("ERROR: Incorrect number of values specified in CDEVAL option. \n")}
if (errcode[i,1]==65)
{cat(" \n")
cat("ERROR: Only indicator or sequential coding of X is allowed with the XMINT option. \n")}
if (errcode[i,1]==66)
{cat(" \n")
cat("ERROR: A reference value of X is required for this model. \n")}
if (errcode[i,1]==67)
{cat(" \n")
cat("ERROR: Too many elements provided in XREFVAL option. \n")}
if (errcode[i,1]==68)
{cat(" \n")
cat("ERROR: Covariate assignment is not allowed with the XMINT option. \n")}
if (errcode[i,1]==69)
{cat(" \n")
cat("ERROR: Incorrect number of values specified in COVAL option. \n")}
if (errcode[i,1]==70)
{cat(" \n")
cat("ERROR: Incorrect value(s) in XREFVAL for this dichotomous X variable. \n")}
if (errcode[i,1]==71)
{cat(" \n")
cat("ERROR: The CENTER option is not available when using the XMINT option. \n")}
if (errcode[i,1]==72)
{cat(" \n")
cat("ERROR: The XMINT option is not available for models with a dichotomous Y. \n")}
if ((errcode[i,1]==52) & (mcerpt==0))
{mcerpt<-1
cat(" \n")
cat("ERROR: A variable specified as multicategorical must have at least three categories. \n")}
if (errcode[i,1]==53)
{cat(" \n")
cat("ERROR: Variables declared as factors or that are non-numeric are not accepted by PROCESS.\n")}
}
#if (saveboot==1)
#{resultm<-list(resultm,boots)}
#invisible(resultm)
resultms<-NULL
if ((saveboot==0) & (saveest==1)){resultms<-resultm}
if ((saveboot==1) & (saveest==0)){resultms<-boots}
if ((saveboot==1) & (saveest==1)){resultms<-(list(boots,resultm))}
invisible(resultms)
}
process(activate=1)
process(data = data, y="inv_sustFund", x="fin_literacy", m="sust_investPositive", w="treatment", model=5, intprobe=1,plot=1,seed=5123)
process(data = data, y="inv_sustFund", x="sust_literacy", m="sust_investPositive", w="treatment", model=5, intprobe=1,plot=1,seed=5123)
process(data = data, y="inv_sustFund", x="sust_preference", m="sust_investPositive", w="treatment", model=5, intprobe=1,plot=1,seed=5123)
library(tidyverse)
library(ggplot2)
library(stargazer)
library(plyr)
library(psych)
library(corrplot)
library(corrtable)
library(marginaleffects)
# Setting the working directory
setwd("C:/Users/mpasq/Dropbox/Tesi Matteo/Investment Game/RICERCA Investment Game/Dati/Codice R/Directory")
# import data frame from .csv file
data <- read.csv("investData.csv")
# Dropping the variable "X", a sequential number automatically generated while creating the .csv file
data = select(data, -1)
# Checking data structure
str(data)
# All ordinal variables have lost their order in the transition to .csv, so we re-encode them as ordinal variables.
# Also, categorical variables have lost the status as categorical variable, so we re-encode them
###########################################################################
########## PART 1 - DATA HANDLING #########################################
###########################################################################
## Age
table(data$age)
data <- data%>%
mutate(age = case_match(age,
"Between 18 and 24" ~ 21,
"Between 25 and 34" ~ 30,
"Between 35 and 44" ~ 40,
"Between 45 and 54" ~ 50,
"More than 55" ~ 55))
## Gender
data <- data %>%
mutate(gender_female = case_match(gender_fem,
"Female" ~ 1,
"Male" ~ 0,
"Other" ~ 0))
data <- data %>%
relocate(gender_female, .after = gender_fem)
data <- select(data, -gender_fem)
## Country
table(data$country)
data <- data %>%
mutate(country = factor(country))
# Income
data <- data %>%
mutate (income = income_bracket)
data <- data%>%
mutate(income = case_match(income,
"<1000 EUR" ~ 1,
"1000-1500 EUR" ~ 1.25,
"1500-2000 EUR" ~ 1.75,
"2000-2500 EUR" ~ 2.25,
"2500-3000 EUR" ~ 2.75,
"3000-5000 EUR" ~ 4,
">5000 EUR" ~ 5))
data <- data%>%
relocate (income, .after=income_bracket)
data <- select(data, -income_bracket)
## savings
data <- data %>%
mutate(savings = factor(savings, ordered = TRUE,
levels = c("<10% of income",
"10-30% of income",
" >30% of income")))
# converting "savings" into a numerical variable
data <- data%>%
mutate(savings = as.character(savings))
data <- data%>%
mutate(savings = case_match(savings,
'<10% of income' ~ 10,
'10-30% of income' ~ 20,
'>30% of income' ~ 30))
# it can't convert '>30% of income' into 30, so i'll replace na values with 30 manually
data$savings[is.na(data$savings)] <- 30
# Debt
data <- data %>%
mutate(debt = family_hasDebt)
data <- data %>%
mutate(debt = case_match(debt,
"1 - Totally Disagree" ~ 1,
"2 - Disagree" ~ 2,
"3 - Neither Agree or Disagree" ~ 3,
"4 - Agree" ~ 4,
"5 - Totally Agree" ~ 5))
data <- data %>%
relocate(debt, .after=family_hasDebt)
data = select(data, -family_hasDebt)
## education
data <- data %>% mutate(education = case_match(education,
"Less than Primary" ~ 0,
"Primary" ~ 5,
"Lower Secondary" ~ 8,
"Upper Secondary" ~ 12,
"Post Secondary" ~ 13,
"Short tertiary" ~ 14,
"Bachelor" ~ 15,
"Masters" ~ 17,
"Doctoral" ~ 20))
## Investor Yes
data <- data %>%
mutate(investoryes = case_match(advisor_reliance,
0 ~ 0,
1 ~ 1,
2 ~ 1,
3 ~ 1))
data <- data %>%
relocate(investoryes, .after = advisor_reliance)
# Advisor_reliance
data <- data %>%
mutate(advisor_reliance = case_match(advisor_reliance,
0 ~ 0,
1 ~ 0,
2 ~ 1,
3 ~ 2))
## owns_sustInvest
data <- data %>%
mutate(owns_sustInvest = case_match(owns_sustInvest,
"Yes" ~ 1,
"No" ~ 0))
## past_sustInvest
data <- data %>%
mutate(past_sustInvest = case_match(past_sustInvest,
"Yes" ~ 1,
"No" ~ 0))
## sust_preference
data <- data%>%
mutate(sust_preference = case_match(sust_preference,
"No" ~ 0,
"Do not know" ~ 1,
"Yes" ~ 1))
## advisor_useful
data <- data %>%
mutate(adv_usefulness = advisor_useful)
data <- data %>%
mutate(adv_usefulness = case_match(adv_usefulness,
"1 - Totally Disagree" ~ 1,
"2 - Disagree" ~ 2,
"3 - Neither Agree or Disagree" ~ 3,
"4 - Agree" ~ 4,
"5- Totally Agree" ~ 5))
data <- data %>% relocate(adv_usefulness, .after=advisor_useful)
data = select(data, -advisor_useful)
## advisor_trustworthy
data <- data %>%
mutate(adv_trustworthiness = advisor_trustworthy)
data <- data %>%
mutate(adv_trustworthiness = case_match(adv_trustworthiness,
"1 - Totally Disagree" ~ 1,
"2 - Disagree" ~ 2,
"3 - Neither Agree or Disagree" ~ 3,
"4 - Agree" ~ 4,
"5- Totally Agree" ~ 5))
data <- data %>% relocate(adv_trustworthiness, .after=advisor_trustworthy)
data = select(data, -advisor_trustworthy)
## trust_SustFunds
data <- data %>% mutate(trusting_Sustfunds = trust_SustFunds)
data <- data %>% mutate(trusting_Sustfunds = case_match(trusting_Sustfunds,
"1- Totally Disagree" ~ 1,
"2 - Disagree" ~ 2,
"3 - Neither Agree or Disagree" ~ 3,
"4 - Agree" ~ 4,
"5 - Totally Agree" ~ 5))
data <- data%>%
relocate(trusting_Sustfunds, .after = trust_SustFunds)
data = select(data, -trust_SustFunds)
## perceived_effect
data <- data %>% mutate(sust_investPositive = perceived_effect)
data <- data %>% mutate(sust_investPositive = case_match(sust_investPositive,
"1- Totally Disagree" ~ 1,
"2 - Disagree" ~ 2,
"3 - Neither Agree or Disagree" ~ 3,
"4 - Agree" ~ 4,
"5 - Totally Agree" ~ 5))
data <- data%>%
relocate(sust_investPositive, .after = perceived_effect)
data = select(data, -perceived_effect)
view(data)
# Define quantiles
taus <- seq(0.1, 0.9, by = 0.1)
# Run quantile regression with sustainability preference interaction
CQTE_sust_pref <- rq(inv_sustFund ~ treatment*sust_preference +
age + gender_female + country + income + savings + debt +
education + household + Household_n.Incomes,
tau = taus, data = data)
library(quantreg)
taus <- seq(0.1, 0.9, by = 0.1)
QTE_full <- rq(inv_sustFund ~ treatment +
age + gender_female + country + income + savings + debt +
education + household + Household_n.Incomes,
tau = taus, data = data)
# We visualize the quantile treatment effect across the full quantile range
plot(summary(QTE_full), parm = "treatment",
main = "",
ylab = "Treatment Coefficient",
xlab = "Quantile")
# Ensure axis labels are rendered (some plot methods ignore xlab/ylab passed via ...)
title(xlab = "Quantile", ylab = "Treatment Coefficient")
# Define quantiles
taus <- seq(0.1, 0.9, by = 0.1)
# Run quantile regression with sustainability preference interaction
CQTE_sust_pref <- rq(inv_sustFund ~ treatment*sust_preference +
age + gender_female + country + income + savings + debt +
education + household + Household_n.Incomes,
tau = taus, data = data)
# Get summary with bootstrap standard errors and covariance matrix
sfm <- summary(CQTE_sust_pref, se = "boot", covariance = TRUE, R = 500)
# Build effects for each sustainability preference level
alpha <- 0.10
z     <- qnorm(1 - alpha/2)
levels_sp <- c(0, 1)  # Binary: Low (0) and High (1)
rows <- list()
for (j in seq_along(taus)) {
coefs <- sfm[[j]]$coefficients
V     <- sfm[[j]]$cov
# Set dimnames if missing
if (is.null(dimnames(V))) {
dimnames(V) <- list(rownames(coefs), rownames(coefs))
}
b_treat <- coefs["treatment", 1]
b_int   <- coefs["treatment:sust_preference", 1]
for (sp in levels_sp) {
eff <- b_treat + sp * b_int
se2 <- V["treatment","treatment"] +
(sp^2) * V["treatment:sust_preference","treatment:sust_preference"] +
2 * sp * V["treatment","treatment:sust_preference"]
se  <- sqrt(se2)
pref_label <- ifelse(sp == 0, "Negative", "Positive")
rows[[length(rows) + 1]] <-
data.frame(tau = taus[j], sust_preference = factor(pref_label, levels = c("Negative", "Positive")),
estimate = eff, lo = eff - z*se, hi = eff + z*se)
}
}
df <- do.call(rbind, rows)
# Plot
p <- ggplot(df, aes(x = tau, y = estimate, color = sust_preference, group = sust_preference)) +
geom_ribbon(aes(ymin = lo, ymax = hi, fill = sust_preference), alpha = 0.15, colour = NA) +
geom_line(linewidth = 0.6) +
geom_point(size = 1.6) +
geom_hline(yintercept = 0) +
scale_x_continuous(breaks = taus) +
labs(x = "Quantile", y = "Treatment Effect",
color = "Sustainability Preferences", fill = "Sustainability Preferences") +
theme_minimal(base_size = 12) +
theme(plot.title = element_text(hjust = 0.5, size = 18, lineheight = 1.1))
print(p)
library(tidyverse)
library(ggplot2)
library(stargazer)
library(plyr)
library(psych)
library(corrplot)
library(corrtable)
library(marginaleffects)
# Setting the working directory
setwd("C:/Users/mpasq/Dropbox/Tesi Matteo/Investment Game/RICERCA Investment Game/Dati/Codice R/Directory")
# import data frame from .csv file
data <- read.csv("investData.csv")
# Dropping the variable "X", a sequential number automatically generated while creating the .csv file
data = select(data, -1)
# Checking data structure
str(data)
# All ordinal variables have lost their order in the transition to .csv, so we re-encode them as ordinal variables.
# Also, categorical variables have lost the status as categorical variable, so we re-encode them
###########################################################################
########## PART 1 - DATA HANDLING #########################################
###########################################################################
## Age
table(data$age)
data <- data%>%
mutate(age = case_match(age,
"Between 18 and 24" ~ 21,
"Between 25 and 34" ~ 30,
"Between 35 and 44" ~ 40,
"Between 45 and 54" ~ 50,
"More than 55" ~ 55))
## Gender
data <- data %>%
mutate(gender_female = case_match(gender_fem,
"Female" ~ 1,
"Male" ~ 0,
"Other" ~ 0))
data <- data %>%
relocate(gender_female, .after = gender_fem)
data <- select(data, -gender_fem)
## Country
table(data$country)
data <- data %>%
mutate(country = factor(country))
# Income
data <- data %>%
mutate (income = income_bracket)
data <- data%>%
mutate(income = case_match(income,
"<1000 EUR" ~ 1,
"1000-1500 EUR" ~ 1.25,
"1500-2000 EUR" ~ 1.75,
"2000-2500 EUR" ~ 2.25,
"2500-3000 EUR" ~ 2.75,
"3000-5000 EUR" ~ 4,
">5000 EUR" ~ 5))
data <- data%>%
relocate (income, .after=income_bracket)
data <- select(data, -income_bracket)
## savings
data <- data %>%
mutate(savings = factor(savings, ordered = TRUE,
levels = c("<10% of income",
"10-30% of income",
" >30% of income")))
# converting "savings" into a numerical variable
data <- data%>%
mutate(savings = as.character(savings))
data <- data%>%
mutate(savings = case_match(savings,
'<10% of income' ~ 10,
'10-30% of income' ~ 20,
'>30% of income' ~ 30))
# it can't convert '>30% of income' into 30, so i'll replace na values with 30 manually
data$savings[is.na(data$savings)] <- 30
# Debt
data <- data %>%
mutate(debt = family_hasDebt)
data <- data %>%
mutate(debt = case_match(debt,
"1 - Totally Disagree" ~ 1,
"2 - Disagree" ~ 2,
"3 - Neither Agree or Disagree" ~ 3,
"4 - Agree" ~ 4,
"5 - Totally Agree" ~ 5))
data <- data %>%
relocate(debt, .after=family_hasDebt)
data = select(data, -family_hasDebt)
## education
data <- data %>% mutate(education = case_match(education,
"Less than Primary" ~ 0,
"Primary" ~ 5,
"Lower Secondary" ~ 8,
"Upper Secondary" ~ 12,
"Post Secondary" ~ 13,
"Short tertiary" ~ 14,
"Bachelor" ~ 15,
"Masters" ~ 17,
"Doctoral" ~ 20))
## Investor Yes
data <- data %>%
mutate(investoryes = case_match(advisor_reliance,
0 ~ 0,
1 ~ 1,
2 ~ 1,
3 ~ 1))
data <- data %>%
relocate(investoryes, .after = advisor_reliance)
# Advisor_reliance
data <- data %>%
mutate(advisor_reliance = case_match(advisor_reliance,
0 ~ 0,
1 ~ 0,
2 ~ 1,
3 ~ 2))
## owns_sustInvest
data <- data %>%
mutate(owns_sustInvest = case_match(owns_sustInvest,
"Yes" ~ 1,
"No" ~ 0))
## past_sustInvest
data <- data %>%
mutate(past_sustInvest = case_match(past_sustInvest,
"Yes" ~ 1,
"No" ~ 0))
## sust_preference
data <- data%>%
mutate(sust_preference = case_match(sust_preference,
"No" ~ 0,
"Do not know" ~ 1,
"Yes" ~ 1))
## advisor_useful
data <- data %>%
mutate(adv_usefulness = advisor_useful)
data <- data %>%
mutate(adv_usefulness = case_match(adv_usefulness,
"1 - Totally Disagree" ~ 1,
"2 - Disagree" ~ 2,
"3 - Neither Agree or Disagree" ~ 3,
"4 - Agree" ~ 4,
"5- Totally Agree" ~ 5))
data <- data %>% relocate(adv_usefulness, .after=advisor_useful)
data = select(data, -advisor_useful)
## advisor_trustworthy
data <- data %>%
mutate(adv_trustworthiness = advisor_trustworthy)
data <- data %>%
mutate(adv_trustworthiness = case_match(adv_trustworthiness,
"1 - Totally Disagree" ~ 1,
"2 - Disagree" ~ 2,
"3 - Neither Agree or Disagree" ~ 3,
"4 - Agree" ~ 4,
"5- Totally Agree" ~ 5))
data <- data %>% relocate(adv_trustworthiness, .after=advisor_trustworthy)
data = select(data, -advisor_trustworthy)
## trust_SustFunds
data <- data %>% mutate(trusting_Sustfunds = trust_SustFunds)
data <- data %>% mutate(trusting_Sustfunds = case_match(trusting_Sustfunds,
"1- Totally Disagree" ~ 1,
"2 - Disagree" ~ 2,
"3 - Neither Agree or Disagree" ~ 3,
"4 - Agree" ~ 4,
"5 - Totally Agree" ~ 5))
data <- data%>%
relocate(trusting_Sustfunds, .after = trust_SustFunds)
data = select(data, -trust_SustFunds)
## perceived_effect
data <- data %>% mutate(sust_investPositive = perceived_effect)
data <- data %>% mutate(sust_investPositive = case_match(sust_investPositive,
"1- Totally Disagree" ~ 1,
"2 - Disagree" ~ 2,
"3 - Neither Agree or Disagree" ~ 3,
"4 - Agree" ~ 4,
"5 - Totally Agree" ~ 5))
data <- data%>%
relocate(sust_investPositive, .after = perceived_effect)
data = select(data, -perceived_effect)
view(data)
datacontrol = subset(data, treatment == 0)
datatreatment = subset(data, treatment == 1)
view(data)
t.test(datatreatment$adv_usefulness, datacontrol$adv_usefulness, var.equal = TRUE, conf.level=0.90)
t.test(datatreatment$adv_usefulness, datacontrol$adv_usefulness, var.equal = TRUE, conf.level=0.95)
t.test(datatreatment$adv_usefulness, datacontrol$adv_usefulness, var.equal = TRUE, conf.level=0.90)
